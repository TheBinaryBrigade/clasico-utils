"use strict";var Clasico=(()=>{var Y=Object.defineProperty;var qe=Object.getOwnPropertyDescriptor;var Je=Object.getOwnPropertyNames,Ce=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,Ge=Object.prototype.propertyIsEnumerable;var ve=(e,t,n)=>t in e?Y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,R=(e,t)=>{for(var n in t||(t={}))we.call(t,n)&&ve(e,n,t[n]);if(Ce)for(var n of Ce(t))Ge.call(t,n)&&ve(e,n,t[n]);return e};var _e=(e,t)=>{for(var n in t)Y(e,n,{get:t[n],enumerable:!0})},Le=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Je(t))!we.call(e,a)&&a!==n&&Y(e,a,{get:()=>t[a],enumerable:!(r=qe(t,a))||r.enumerable});return e};var Ze=e=>Le(Y({},"__esModule",{value:!0}),e);var vt={};_e(vt,{default:()=>Ct});var Be={};var pe={};_e(pe,{BisectArray:()=>S,ReverseCompareArray:()=>ce,ReverseNumberArray:()=>ie,ReverseSortedArray:()=>z,ReverseStringArray:()=>ae,SortedArray:()=>re,SortedCompareArray:()=>le,SortedNumberArray:()=>oe,SortedStringArray:()=>ue});var Ye=e=>{let t=e.getDay();return t===0||t===6},Ke=(e,t,n)=>e>=t&&e<=n,Xe=e=>{let t=new Date(e);return isNaN(t.getTime())?null:t},Qe=e=>{let t=Math.floor((+new Date-+e)/1e3),n=t/31536e3;return n>1?(n=Math.floor(n),[n,n===1?"year":"years"]):(n=t/2592e3,n>1?(n=Math.floor(n),[n,n===1?"month":"months"]):(n=t/86400,n>1?(n=Math.floor(n),[n,n===1?"day":"days"]):(n=t/3600,n>1?(n=Math.floor(n),[n,n===1?"hour":"hours"]):(n=t/60,n>1?(n=Math.floor(n),[n,n===1?"minute":"minutes"]):(n=Math.floor(t),[n,n===1?"second":"seconds"])))))},I={parse:Xe,isWeekend:Ye,between:Ke,timeSince:Qe};var ee=e=>typeof e=="number"||e instanceof Number,He=e=>typeof e=="bigint"||e instanceof BigInt,D=e=>typeof e=="string"||e instanceof String,te=e=>typeof e=="boolean"||e instanceof Boolean,ne=e=>typeof e=="function"||e instanceof Function,et=e=>F(e)?!1:typeof e=="object",F=e=>e==null,xe=e=>Array.isArray(e)||e instanceof Array||Object.prototype.toString.call(e)==="[object Array]",Te=e=>e instanceof Set||Object.prototype.toString.call(e)==="[object Set]",tt=e=>F(e)?!1:ne(e[Symbol.iterator]),nt=e=>ee(e)?!0:D(e)?!isNaN(e)&&!isNaN(parseFloat(e)):!1,se=e=>{if(te(e))return!0;let t=ee(e),n=D(e);if(t||n){let r=["true","false",1,0,"1","0",new Boolean(!0),new Boolean(!1),!0,!1];if(r.includes(e))return!0;if(n){e=e.trim();let a=Math.max(...r.map(u=>u.toString().length));if(e.length<=a&&r.includes(e.toLowerCase()))return!0}}return!1},Ee=e=>(e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof BigInt||e instanceof Symbol)&&e.valueOf&&ne(e.valueOf)?e.valueOf():e,Ne=e=>{let t=Ee(e);if(e===!0||t===!0)return!0;if(se(e)){let n=[!0,"true","1",1,new Boolean(!0)];if(n.includes(e))return!0;if(!F(t)){if(n.includes(t))return!0;D(t)&&(e=t)}if(D(e)){let r=e.trim(),a=Math.max(...n.map(u=>u.toString().length));if(r.length<=a&&n.includes(r.toLowerCase()))return!0}}return!1},st=e=>e===!1||Ee(e)===!1?!0:se(e)?!Ne(e):!1,rt=e=>F(e)||D(e)&&typeof e=="string"&&(e=e.trim(),!e)||te(e)||xe(e)||Te(e)?!1:!!I.parse(e),it=(e,t=!1)=>F(e)?!1:!!(e instanceof Error||t&&e&&e.stack&&e.message),h={isNil:F,isNumber:ee,isBigInt:He,isString:D,isBoolean:te,isFunction:ne,isObject:et,isNumeric:nt,isValidBoolean:se,isTrue:Ne,isFalse:st,isArray:xe,isSet:Te,isIterable:tt,isDate:rt,isError:it};var S=class extends Array{constructor(n){let r=n.items;super(...r);this.opts=n;this.isValidCmp()?this.sort(this.opts.cmp):this.sort((a,u)=>this.opts.key(a)-this.opts.key(u)),this.opts.asReversed&&this.reverse()}pop(){return this.isReversed()?super.pop():super.shift()}push(...n){for(let r of n){let a=this.binarySearch(r);this.splice(a,0,r)}return this.length}binarySearch(n){let r=0,a=this.length-1;for(;r<=a;){let u=Math.floor((r+a)/2);if(this.shouldSwap(this[u],n))r=u+1;else if(this.shouldSwap(n,this[u]))a=u-1;else return u}return r}shouldSwap(n,r){if(this.opts.cmp&&this.isValidCmp())return this.isReversed()?this.opts.cmp(r,n)<=0:this.opts.cmp(n,r)<=0;let a=this.opts.key(n),u=this.opts.key(r);return this.isReversed()?u-a<=0:a-u<=0}isValidCmp(){return this.opts.cmp&&h.isFunction(this.opts.cmp)}isReversed(){return this.opts.asReversed}},z=class extends S{constructor(t,...n){super({key:t,asReversed:!0,items:n})}},re=class extends S{constructor(t,...n){super({key:t,asReversed:!1,items:n})}},ie=class extends S{constructor(...t){super({key:n=>n,asReversed:!0,items:t})}},oe=class extends S{constructor(...t){super({key:n=>n,asReversed:!1,items:t})}},ae=class extends S{constructor(...t){super({key:()=>0,cmp:(n,r)=>n.localeCompare(r),asReversed:!0,items:t})}},ue=class extends S{constructor(...t){super({key:()=>0,cmp:(n,r)=>n.localeCompare(r),asReversed:!0,items:t})}},ce=class extends S{constructor(t,...n){super({key:()=>0,cmp:t,asReversed:!0,items:n})}},le=class extends S{constructor(t,...n){super({key:()=>0,cmp:t,asReversed:!0,items:n})}};var ke=R({},pe);function Re(e,t,n){function r(v,p,C){let g=new Map;for(let _=p;_<=C;_++){let $=v[_];g.has($)?(g.get($).count++,g.get($).index=_):g.set($,{count:1,index:_})}return g.forEach((_,$,b)=>{_.count!==1?b.delete($):b.set($,_.index)}),g}function a(v,p,C,g,_,$){let b=r(v,p,C),A=r(g,_,$);return b.forEach((H,j,Z)=>{A.has(j)?Z.set(j,{indexA:H,indexB:A.get(j)}):Z.delete(j)}),b}function u(v){let p=[];v.forEach((g,_,$)=>{let b=0;for(;p[b]&&p[b][p[b].length-1].indexB<g.indexB;)b++;p[b]||(p[b]=[]),0<b&&(g.prev=p[b-1][p[b-1].length-1]),p[b].push(g)});let C=[];if(0<p.length){let g=p.length-1;for(C=[p[g][p[g].length-1]];C[C.length-1].prev;)C.push(C[C.length-1].prev)}return C.reverse()}let o=[],i=0,l=0,m=[],c=[],d=[],x=[];function E(v,p){p<0?(m.push(e[v]),c.push(o.length),i++):v<0&&(d.push(t[p]),x.push(o.length),l++),o.push({line:0<=v?e[v]:t[p],aIndex:v,bIndex:p})}function N(v,p,C,g){for(;v<=p&&C<=g&&e[v]===t[C];)E(v++,C++);let _=p;for(;v<=p&&C<=g&&e[p]===t[g];)p--,g--;let $=a(e,v,p,t,C,g);if($.size===0){for(;v<=p;)E(v++,-1);for(;C<=g;)E(-1,C++)}else M(v,p,C,g,$);for(;p<_;)E(++p,++g)}function M(v,p,C,g,_){let $=u(_||a(e,v,p,t,C,g));if($.length===0)N(v,p,C,g);else{(v<$[0].indexA||C<$[0].indexB)&&N(v,$[0].indexA-1,C,$[0].indexB-1);let b;for(b=0;b<$.length-1;b++)N($[b].indexA,$[b+1].indexA-1,$[b].indexB,$[b+1].indexB-1);($[b].indexA<=p||$[b].indexB<=g)&&N($[b].indexA,p,$[b].indexB,g)}}return M(0,e.length-1,0,t.length-1),n?{lines:o,lineCountDeleted:i,lineCountInserted:l,lineCountMoved:0,aMove:m,aMoveIndex:c,bMove:d,bMoveIndex:x}:{lines:o,lineCountDeleted:i,lineCountInserted:l,lineCountMoved:0}}var St=Re([],[],!0),ot=(e,t)=>{let n=Re(e.split(`
`),t.split(`
`),!0);return{changes:n.lines.map((a,u)=>{let o="unknown";return a.aIndex>=0&&a.bIndex<0?o="deleted":a.aIndex<0&&a.bIndex>=0?o="inserted":a.aIndex>=0&&a.bIndex>=0&&(o="changed"),{changeType:o,lineNumber:u+1,lineContent:a.line,aIndex:a.aIndex,bIndex:a.bIndex}}),deletedCount:n.lineCountDeleted,insertedCount:n.lineCountInserted,movedCount:n.lineCountInserted,linedMovedFromA:n.aMove||[],linesMovedFromB:n.bMove||[],_diff:n}},Se={compare:ot};var fe=(e,t,n=2)=>{let r=(d,x)=>{d=" ".repeat(x-1)+d.toLowerCase()+" ".repeat(x-1);let E=new Array(d.length-x+1);for(let N=0;N<E.length;N++)E[N]=d.slice(N,N+x);return E};if(!(e!=null&&e.length)||!(t!=null&&t.length))return 0;let a=e.length<t.length?e:t,u=e.length<t.length?t:e,o=r(a,n),i=r(u,n),l=new Set(o),m=i.length,c=0;for(let d of i)l.delete(d)&&c++;return c/m},at=(e,t,n,r=5,a=.35,u=2)=>{let o=n(e);r<=0&&(r=5);let i=new Map,l=new z(m=>{let c=n(m),d=i.get(c),x=d||fe(o,c,u);return d===void 0&&i.set(c,x),x});return t.forEach(m=>{if(fe(o,n(m),u)>=a&&(l.push(m),l.length>r)){let d=l.pop();d&&i.delete(n(d))}}),[...l]},K={similarity:fe,topSimilar:at};var ut=(e,t=!0)=>{if(t&&!h.isString(e)){if(h.isSet(e)&&(e=Array.from(e)),h.isObject(e))try{e=JSON.stringify(e)}catch(r){let a=[];e=JSON.stringify(e,(o,i)=>{if(typeof i=="object"&&i!==null){if(a.includes(i))return"[Circular]";a.push(i)}return i}).replace(/"\[Circular\]"/g,()=>JSON.stringify("[Circular]"))}!h.isString(e)&&e.toString&&(e=e.toString())}if(!h.isString(e))return null;let n=0;for(let r=0;r<e.length;++r){let a=e.charCodeAt(r);n=(n<<5)-n+a,n&=n}return n},ct=e=>h.isString(e)?e.charAt(0).toUpperCase()+e.slice(1):"",V={hashCode:ut,capitalize:ct};var he=[[/(quiz)$/i,"$1zes"],[/^(oxen)$/i,"$1"],[/^(ox)$/i,"$1en"],[/(m|l)ice$/i,"$1ice"],[/(m|l)ouse$/i,"$1ice"],[/(passer)s?by$/i,"$1sby"],[/(matr|vert|ind)(?:ix|ex)$/i,"$1ices"],[/(x|ch|ss|sh)$/i,"$1es"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/(hive)$/i,"$1s"],[/([lr])f$/i,"$1ves"],[/([^f])fe$/i,"$1ves"],[/sis$/i,"ses"],[/([ti])a$/i,"$1a"],[/([ti])um$/i,"$1a"],[/(buffal|potat|tomat)o$/i,"$1oes"],[/(bu)s$/i,"$1ses"],[/(alias|status)$/i,"$1es"],[/(octop|vir)i$/i,"$1i"],[/(octop|vir)us$/i,"$1i"],[/^(ax|test)is$/i,"$1es"],[/s$/i,"s"],[/$/i,"s"]],me=[[/(database)s$/i,"$1"],[/(quiz)zes$/i,"$1"],[/(matr)ices$/i,"$1ix"],[/(vert|ind)ices$/i,"$1ex"],[/(passer)sby$/i,"$1by"],[/^(ox)en/i,"$1"],[/(alias|status)(es)?$/i,"$1"],[/(octop|vir)(us|i)$/i,"$1us"],[/^(a)x[ie]s$/i,"$1xis"],[/(cris|test)(is|es)$/i,"$1is"],[/(shoe)s$/i,"$1"],[/(o)es$/i,"$1"],[/(bus)(es)?$/i,"$1"],[/(m|l)ice$/i,"$1ouse"],[/(x|ch|ss|sh)es$/i,"$1"],[/(m)ovies$/i,"$1ovie"],[/(s)eries$/i,"$1eries"],[/([^aeiouy]|qu)ies$/i,"$1y"],[/([lr])ves$/i,"$1f"],[/(tive)s$/i,"$1"],[/(hive)s$/i,"$1"],[/([^f])ves$/i,"$1fe"],[/(t)he(sis|ses)$/i,"$1hesis"],[/(s)ynop(sis|ses)$/i,"$1ynopsis"],[/(p)rogno(sis|ses)$/i,"$1rognosis"],[/(p)arenthe(sis|ses)$/i,"$1arenthesis"],[/(d)iagno(sis|ses)$/i,"$1iagnosis"],[/(b)a(sis|ses)$/i,"$1asis"],[/(a)naly(sis|ses)$/i,"$1nalysis"],[/([ti])a$/i,"$1um"],[/(n)ews$/i,"$1ews"],[/(ss)$/i,"$1"],[/s$/i,""]],de=new Set(["equipment","fish","information","jeans","money","rice","series","sheep","species"]),B=(e,t)=>{let n=o=>Array.from(o).map(i=>"["+i+i.toUpperCase()+"]").join(""),r=(o,i,l)=>{o.splice(i,0,[new RegExp(l[0],"i"),l[1]])},a=(o,i)=>{r(he,o,i)},u=(o,i)=>{r(me,o,i)};e[0].toUpperCase()==t[0].toUpperCase()?(a(0,[`(${e[0]})${e.slice(1)}$`,"$1"+t.slice(1)]),a(0,[`(${t[0]})${t.slice(1)}$`,"$1"+t.slice(1)]),u(0,[`(${t[0]})${t.slice(1)}$`,"$1"+e.slice(1)])):(a(0,[`${e[0].toUpperCase()}${n(e.slice(1))}$`,t[0].toUpperCase()+t.slice(1)]),a(0,[`${e[0].toLowerCase()}${n(e.slice(1))}$`,t[0].toLowerCase()+t.slice(1)]),a(0,[`${t[0].toUpperCase()}${n(t.slice(1))}$`,t[0].toUpperCase()+t.slice(1)]),a(0,[`${t[0].toLowerCase()}${n(t.slice(1))}$`,t[0].toLowerCase()+t.slice(1)]),u(0,[`${t[0].toUpperCase()}${n(t.slice(1))}$`,e[0].toUpperCase()+e.slice(1)]),u(0,[`${t[0].toLowerCase()}${n(t.slice(1))}$`,e[0].toLowerCase()+e.slice(1)]))},lt=(e,t=!0)=>{let n=Oe(e).replace(/-/," ").replace(/(?:^\w|[A-Z]|\b\w)/g,(a,u)=>u===0?a.toLowerCase():a.toUpperCase()).replace(/\s+/g,"");return t?n.charAt(0).toUpperCase()+n.slice(1):n},Oe=e=>e.replace(/_/g,"-"),Ae=e=>(e=e.replace(/_id$/i,""),e=e.replace(/_/g," "),e=e.replace(/([a-z\d]*)/g,t=>t.toLowerCase()),e=e.replace(/^\w/,t=>t.toUpperCase()),e),We=e=>{e=typeof e=="number"?e:parseInt(e);let t=Math.abs(e);if([11,12,13].includes(t%100))return"th";switch(t%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}},pt=e=>e.toString()+We(e),ft=(e,t="-")=>{let r=je(e).replace(/[^\d\w-]+/gmi,t);if(t!==""){for(;r.startsWith(t);)r=r.slice(t.length);for(;r.endsWith(t);)r=r.slice(0,r.length-t.length)}return r.toLowerCase()},Me=e=>{let t=/[A-Z]/.test(e.charAt(0)),n=/[A-Za-z]$/.test(e);if(!e||de.has(e.toLowerCase())||!n)return e;for(let r of he){let a=r[0],u=r[1];if(a.test(e)){let o=e.replace(a,u);return t?V.capitalize(o):o}}return e},ht=e=>{let t=/[A-Z]/.test(e.charAt(0));for(let n of de)if(new RegExp(`\\b${n}\\b`,"i").test(e))return e;for(let n of me){let r=n[0],a=n[1];if(r.test(e)){let u=e.replace(r,a);return t?V.capitalize(u):u}}return e},mt=e=>Me(ge(e)),dt=e=>Ae(ge(e)).split(/\s+/).map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "),je=e=>e.normalize("NFKD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x00-\x7F]/g,"").trim(),ge=e=>{let t=e.replace(/([a-z\d])([A-Z])/g,"$1_$2");return t=t.replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2"),t=t.replace(/-/g,"_"),t.toLowerCase()};B("person","people");B("man","men");B("human","humans");B("child","children");B("sex","sexes");B("move","moves");B("cow","kine");B("zombie","zombies");B("slave","slaves");B("this","this");B("flour","flour");B("milk","milk");B("water","water");B("reserve","reserves");B("gas","gasses");B("bias","biases");B("atlas","atlases");B("goose","geese");B("pasta","pastas");B("slice","slices");B("cactus","cacti");var q={camelize:lt,dasherize:Oe,humanize:Ae,ordinal:We,ordinalize:pt,parameterize:ft,pluralize:Me,singularize:ht,tableize:mt,titleize:dt,transliterate:je,underscore:ge,UNCOUNTABLES:de,PLURALS:he,SINGULARS:me};var J="$B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B_B",O={0:"PREC0",1:"PREC1",2:"COUNT_PRECS",PREC0:0,PREC1:1,COUNT_PRECS:2};Object.freeze(O);Object.seal(O);var G={"+":{func:(e,t)=>[e,t].every(h.isNumber)?e+t:`${e}+${t}`,prec:O.PREC0},"-":{func:(e,t)=>[e,t].every(h.isNumber)?e-t:`${e}-${t}`,prec:O.PREC0},"*":{func:(e,t)=>[e,t].every(h.isNumber)?e*t:`${e}*${t}`,prec:O.PREC1},"/":{func:(e,t)=>[e,t].every(h.isNumber)?e/t:`${e}/${t}`,prec:O.PREC1},"%":{func:(e,t)=>[e,t].every(h.isNumber)?e%t:`${e}%${t}`,prec:O.PREC1}},X={"-":e=>-e},Q=class{constructor(t,n=[],r="(),",a=!1){this.src=t;this.hist=n;this.syntax=r;this.alreadyCrashed=a}nextToken(){let t=this.next();return t!==null&&this.unnext(t),t}lastToken(){return this.hist[this.hist.length-1]}unnext(t){this.src=t+this.src,this.hist.pop()}next(){if(this.src=this.src.trimStart(),this.src.length==0)return null;let t=i=>i in G||i in X||this.syntax.includes(i),n=this.src.startsWith('"'),r=this.src.startsWith("'"),a=n||r,u=this.src.indexOf(n?'"':"'",1);if(a&&u>0){let i=this.src.slice(0,u+1);return this.src=this.src.slice(u+1),this.hist.push(i),i}if(t(this.src[0])){let i=this.src[0];return this.src=this.src.slice(1),this.hist.push(i),i}for(let i=0;i<this.src.length;++i)if(t(this.src[i])||this.src[i]==" "){let l=this.src.slice(0,i);return this.src=this.src.slice(i),this.hist.push(l),l}let o=this.src;return this.hist.push(o),this.src="",o}hasNext(){let t=this.next(),n=t!==null;return n&&this.unnext(t),n}spaceAfterToken(){let t=this.next(),n=t!==null;if(n&&this.src){let r=this.src.length-this.src.trimStart().length;if(r>0)return this.unnext(t)," ".repeat(r)}return n&&this.unnext(t),""}},Ie=e=>{let t=e.next();if(t!==null)if(t in X){let n=W(e);return{kind:"unary_op",payload:{op:t,operand:n}}}else if(t==="("){let n=W(e);if(t=e.next(),t===J&&(t=e.next()),t!==")")throw new Error("Expected ')' but got '"+t+"'");return n}else if(t===")"){if(!e.alreadyCrashed)return e.alreadyCrashed=!0,e.unnext(","+J+")"),Ie(e);throw new Error("No primary expression starts with ')'")}else{let n=e.next();if(n==="("){let r=[];if(n=e.next(),n===")")return{kind:"funcall",payload:{name:t,args:r}};if(n===null)throw Error("Unexpected end of input");for(e.unnext(n),r.push(W(e)),n=e.next(),n===J&&(n=e.next());n==",";)r.push(W(e)),n=e.next(),n===J&&(n=e.next());return n===J&&(n=e.next()),n!==")"?{kind:"symbol",payload:{value:t}}:{kind:"funcall",payload:{name:t,args:r}}}else return n!==null&&e.unnext(n),{kind:"symbol",payload:{value:t}}}else throw new Error("Expected primary expression but reached the end of the input")},W=(e,t=O.PREC0)=>{if(t>=O.COUNT_PRECS)return Ie(e);let n=W(e,t+1),r=e.next();if(r!==null)if(r in G&&G[r].prec==t){let a=W(e,t);return{kind:"binary_op",payload:{op:r,lhs:n,rhs:a}}}else e.unnext(r);return n},P=(e,t={},n=[])=>{console.assert(h.isObject(e));let r=o=>{n.push({timestamp:new Date,message:o})},a=(o,i)=>K.topSimilar(i,[...Object.keys(t[o]||{})],l=>l,5).map(l=>l.replace(/[\u00A0-\u9999<>&]/g,m=>"&#"+m.charCodeAt(0)+";")),u=(o,i)=>i>1?q.pluralize(o):q.singularize(o);switch(e.kind){case"symbol":{let i=e.payload.value,l=Number(i);if(isNaN(l)){if(t.vars&&i&&i in t.vars)return t.vars[i];if(i!=null&&i.startsWith("$")&&!/^\$\d/.test(i)){let m=a("vars",i),c=u("variable",m.length),d=m.length>1?"are":"is",x=` The most similar ${c} ${d} ${m.join(", ")}`;r("Unknown variable '"+i+"'."+(m.length>0?x:"")),i in(t.funcs||{})&&r("'"+i+"' is defined as a function.")}return i}else return l}case"unary_op":{let o=e.payload,i=o==null?void 0:o.op,l=o==null?void 0:o.operand;if(i&&i in X){if(l===void 0)throw new Error("operand needs to be an object not undefined");return X[i](P(l,t))}throw new Error("Unknown unary operator '"+o.op+"'")}case"binary_op":{let o=e.payload,i=o==null?void 0:o.op,l=o==null?void 0:o.lhs,m=o==null?void 0:o.rhs;if(i&&i in G){if(l===void 0)throw new Error(`lhs operand needs to be an object not undefined: lhs=${l} :: rhs=${m}`);if(m===void 0)throw new Error(`rhs operand needs to be an object not undefined: lhs=${l} :: rhs=${m}`);return G[i].func(P(l,t),P(m,t))}throw new Error("Unknown binary operator '"+i+"'")}case"funcall":{let o=e.payload,i=o.name,l=o.args;if(t.funcs&&i!==void 0&&l!==void 0&&i in t.funcs){let c;return(c=t.funcs)[i].apply(c,l.map(d=>P(d,t)))}if(i!=null&&i.startsWith("$")&&!/^\$\d/.test(i)){let c=a("funcs",i),d=u("function",c.length),x=c.length>1?"are":"is",E=` The most similar ${d} ${x} ${c.join(", ")}`;r("Unknown function '"+i+"'."+(c.length>0?E:"")),i in(t.vars||{})&&r("'"+i+"' is defined as a variable.")}let m=l==null?void 0:l.map(c=>{var d;return(d=c==null?void 0:c.payload)==null?void 0:d.value}).map(c=>h.isObject(c)?JSON.stringify(c):c).join(", ");return`${i}(${m||""})`}default:throw new Error("Unexpected AST node '"+e.kind+"'")}};var gt=e=>(h.isString(e)&&(e.startsWith('"')&&e.endsWith('"')||e.startsWith("'")&&e.endsWith("'"))&&(e=e.substring(1,e.length-1)),e),yt=e=>{let t=e==null?void 0:e.funcs;if(t&&h.isObject(t)){let n=R({},t),r={};Object.keys(n).forEach(a=>{r[a]=(...u)=>(u=u.map(gt),n[a](...u))}),e.funcs=r}return e},Fe=(e,t={})=>{let n=[];return{result:e.split(`
`).map((a,u)=>{try{let o=De(a,t);return n.push(...o.warnings.map(i=>R({lineNumber:u+1,level:"WARN"},i))),o.result}catch(o){if(o.message.toLowerCase().startsWith("no primary expression starts with ')'")||o.message.startsWith("Expected ')' but got '")){let l=a.replace(/(\W)\(([^)]+)\)/g,"$1 <parentheses> $2 </parentheses>");try{let m=De(l,t);return n.push(...m.warnings.map(c=>R({lineNumber:u+1,level:"WARN"},c))),m.result.replace(/<parentheses> /gi,"(").replace(/ <\/parentheses>/gi,")")}catch(m){}}let i="";o&&(i=o.message,!i&&o.toString&&(i=o.toString())),i||(i=`${o}`),n.push({lineNumber:u+1,level:"ERROR",message:i,error:o,timestamp:new Date})}return a}).join(`
`),logs:n}},De=(e,t={})=>{var o;let n=[],r=yt(R({},t)),a=new Q(e),u=[];for(;a.hasNext();){let i=a.spaceAfterToken(),l="",m=W(a),c=m.payload.value,d=[];if(c&&h.isString(c)&&c.startsWith("$")){l=i;let C=c.endsWith("."),g=c.endsWith("!"),_=c.endsWith("("),$=c.endsWith(")"),b=c.endsWith(">"),A=c.endsWith("<");for(;c&&(C||g||_||$||b||A);)c=c.substring(0,c.length-1),C?d.push("."):g?d.push("!"):_?d.push("("):$?d.push(")"):b?d.push(">"):A&&d.push("<"),C=c.endsWith("."),g=c.endsWith("!"),_=c.endsWith("("),$=c.endsWith(")"),b=c.endsWith(">"),A=c.endsWith("<");d.length!==0&&(m.payload.value=c)}let x=m.kind==="funcall",E=m.kind==="symbol",N=P(m,r,n),M=d.join("");u.push(N+M+l);let v=(o=a.lastToken())==null?void 0:o.startsWith("$"),p=u.lastIndexOf(",")-1;a.lastToken()===","&&u[p]===" "&&u.splice(p,1),x&&!["!",".",","].includes(a.nextToken())&&u.push(" "),x||E&&v||u.push(" ")}return{result:u.join("").trim(),warnings:n}},L=class{constructor(t={includeBuiltIns:!0},n={},r=[]){this.options=t;this.ctx=n;this.logs=r;this.options.includeBuiltIns&&(this.ctx.funcs=R(R({},this.builtinFunctions()),this.ctx.funcs||{}))}builtinFunctions(){let t=s=>Math.abs(s),n=(...s)=>s.map(a).every(f=>f===!0),r=(...s)=>s.map(a).some(f=>f===!0),a=s=>h.isValidBoolean(s)?h.isTrue(s):!!s&&be(s),u=s=>parseFloat(s),o=s=>{if(v(s))return`${s}`;if(h.isObject(s))try{s=JSON.stringify(s)}catch(f){let y=[];s=JSON.stringify(s,(k,T)=>{if(typeof T=="bigint")return T.toString();if(typeof T=="object"&&T!==null){if(y.includes(T))return"[Circular]";y.push(T)}return T}).replace(/"\[Circular\]"/g,()=>JSON.stringify("[Circular]"))}return h.isString(s)||(s=s.toString?s.toString():`${s}`),s},i=(s,...f)=>(!h.isString(s)||f.length===0||f.map(o).forEach((y,w)=>{let k=`{${w}}`;for(;s.includes(k);)s=s.replace(k,y)}),s),l=(s,f,y)=>a(s)?f:y,m=s=>parseInt(s),c=(s,...f)=>{let y=$e(s);return f.map(o).some(w=>y===w)},d=s=>c(s,"string"),x=s=>c(s,"number","bigint"),E=s=>c(s,"undefined"),N=s=>c(s,"object"),M=s=>c(s,"boolean"),v=s=>s==null,p=(s,f,y)=>(s=o(s),f=o(f),s.endsWith(f,y)),C=(s,f,y)=>o(s).startsWith(f,y),g=s=>o(s).toLowerCase(),_=s=>o(s).toUpperCase(),$=s=>o(s).length,b=(...s)=>Math.max(...s.map(o).map(u).filter(f=>!isNaN(f))),A=(...s)=>Math.min(...s.map(o).map(u).filter(f=>!isNaN(f))),H=(s,f)=>Math.pow(s,f),j=s=>Math.round(s),Z=(s,...f)=>{try{let w=Math[s],k=h.isFunction(w)?w(...f):w;if(k)return k}catch(w){this.logs.push({level:"ERROR",error:w,message:w.message||`${w}`,lineNumber:NaN,timestamp:new Date})}let y=f.join(", ");return this.logs.push({level:"WARN",lineNumber:NaN,message:`Couldn't resolve Math.${s}${y?"("+y+")":""}`,timestamp:new Date}),`$math('${s}'${y?", "+y:""})`},Pe=(...s)=>s.map(o).join(""),Ue=(s,f,y)=>{let w=o(s);return(f===void 0||!h.isNumber(f)||f<0)&&(f=0),(y===void 0||!h.isNumber(f)||y>w.length)&&(y=w.length),w.substring(f,y)},$e=s=>typeof s,ze=(s,...f)=>{let y=s;return f.filter(h.isString).forEach(w=>{let k=w.split(".");y[k[0]]||(k=[w]),k.filter(T=>!!T).forEach(T=>{y&&T&&y[T]&&(y=y[T])})}),y},Ve=(s,...f)=>{let y=s,w=!0;return f.filter(h.isString).forEach(k=>{let T=k.split(".");y[T[0]]||(T=[k]),T.filter(U=>!!U).forEach(U=>{y&&U&&y[U]?y=y[U]:w=!1})}),w},be=s=>!o(s).startsWith("$");return{$if:l,$abs:t,$all:n,$any:r,$bool:a,$float:u,$str:o,$format:i,$int:m,$isnil:v,$isinstance:c,$tisstring:d,$tisnumber:x,$tisboolean:M,$tisundefined:E,$tisobject:N,$len:$,$max:b,$min:A,$pow:H,$round:j,$substring:Ue,$type:$e,$math:Z,$getattr:ze,$concat:Pe,$hasattr:Ve,$isset:be,$includes:(s,f)=>{if(s){if(s.includes&&h.isFunction(s.includes))return s.includes(f);if(s.has&&h.isFunction(s.has))return s.has(f)}return!1},$endsWith:p,$startsWith:C,$lower:g,$upper:_,$now:()=>new Date}}fixName(t){return t.startsWith("$")?t:"$"+t}fnExists(t){return t=this.fixName(t),t in(this.ctx.funcs||{})}varExists(t){return t=this.fixName(t),t in(this.ctx.vars||{})}addVar(t,n){t=this.fixName(t),this.ctx.vars=this.ctx.vars||{},this.ctx.vars[t]=n}addFunction(t,n){t=this.fixName(t),this.ctx.funcs=this.ctx.funcs||{},this.ctx.funcs[t]=n}clearLogs(){this.logs=[]}parse(t){let n=Fe(t,this.ctx||{});return this.logs.push(...n.logs),n}},$t=e=>{if(h.isNumeric(e))return parseFloat(e);if(h.isValidBoolean(e))return h.isTrue(e);if(I.parse(e)!==null)return new Date(e);if(e==="undefined")return;if(e==="null")return null;try{return JSON.parse(e)}catch(t){return e}},bt=(e,t)=>{let n=Fe(e,t||{});return{result:$t(n.result),logs:n.logs}},Gt=new L({includeBuiltIns:!1}).builtinFunctions,ye={SentenceParser:L,TemplateParser:L,lval:bt};var Ct=R({check:h,parser:ye,template:ye,inflection:q,utils:V,date:I,fuzzy:K,array:ke,diff:Se},Be);return Ze(vt);})();
//# sourceMappingURL=clasico-utils.js.map
